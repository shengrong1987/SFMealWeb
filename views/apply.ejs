
<div class="text-center base_container" style="margin-top:-20px;">
  <div class="row">
    <div class="pure-banner vertical-align green">
      <div style="width: 600px;" class="middle banner-text">
        <div class="row vertical-align" style="margin-bottom: 5px;">
          <div class="col-sm-3">
            <a href="/" class="logo logo-sm"></a>
          </div>
          <div class="col-sm-9">
            <h4 class="text-white"><strong><%= __('welcome') %></strong></h4>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="applyView" data-host-id="<%= user.host ? user.host : '' %>" class="default-container">
    <div class="box white">
      <h4 class="text-green"><%= __('apply-title') %></h4>

      <hr>

      <div class="progress">
        <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="1" aria-valuemin="1" aria-valuemax="5" style="width: 20%;">
          <%= __('step-%d-of-%d',1,5)%>
        </div>
      </div>

      <div class="navbar">
        <div class="navbar-inner">
          <ul class="nav nav-pills">
            <li class="active"><a href="#step1" data-toggle="tab" data-pass="<%= user.host || ''%>" data-step="1"><%= __('step1')%></a><br/><% if(user.host){%><i class="fa fa-check text-green"></i><%}%></li>
            <li><a href="#step2" data-toggle="tab" data-pass="<%= hasAddress%>" data-step="2"><%= __('step2')%></a><br/><% if(hasAddress){%><i class="fa fa-check text-green"></i><%}%></li>
            <li><a href="#step3" data-toggle="tab" data-pass="<%= hasDish%>" data-step="3"><%= __('step3')%></a><br/><%if(hasDish){%><i class="fa fa-check text-green"></i><%}%></li>
            <li><a href="#step4" data-toggle="tab" data-pass="<%= hasMeal%>" data-step="4"><%= __('step4')%></a><br/><%if(hasMeal){%><i class="fa fa-check text-green"></i><%}%></li>
            <li><a href="#step5" data-toggle="tab" data-pass="<%= hasAccount%>" data-step="5"><%= __('step5')%></a><br/><%if(hasAccount){%><i class="fa fa-check text-green"></i><%}%></li>
            <% if(user.host){%>
              <li><a href="#step6" data-toggle="tab" data-pass="<%= !verification%>" data-step="6"><%= __('step6')%></a><br/><%if(!verification){%><i class="fa fa-check text-green"></i><%}%></li>
            <%}%>
          </ul>
        </div>
      </div>
      <div class="tab-content">
        <div class="tab-pane fade in active" id="step1">

          <% if( typeof user.host !== 'undefined' && user.host){%>
            <div class="well">
              <label><%= __('step1-success')%></label>
              <br>
              <h4><small><%= __('step1-success-tip')%></small></h4>
            </div>
            <icon class="fa fa-check text-green"></icon>
            <button class="btn btn-default round next"><%= __('continue')%></button>
          <%}else{%>
            <div class="well">
              <label><%= __('step1-ongoing')%></label>
              <br>
              <h4><small><%= __('step1-ongoing-tip')%><a href="/legal"><%= __('SFMeal-agreement')%></a><%= __('and')%><a href="https://stripe.com/us/legal/"><%= __('stripe-agreement')%></a></small></h4>
            </div>
            <div class="form-group">
              <label><%= __('apply-shopname')%></label>
              <input class="form-control middle" name="shopName" style="width: 200px;" type="text" required>
            </div>
            <button id="applyBtn" class="btn btn-info round"><%= __('step1-action-btn')%></button>
            <h2></h2>
            <div class="alert alert-danger" data-toggle="alert"></div>
          <%}%>
        </div>

        <div class="tab-pane fade" id="step2">

          <% if( hasAddress ){%>
          <div class="well">
            <label><%= __('step2-success')%></label>
            <br>
            <h4><small><%= __('step2-success-tip')%></small></h4>
          </div>
          <icon class="fa fa-check text-green"></icon>
          <button class="btn btn-default round next"><%= __('continue')%></button>
          <%}else{%>
          <div class="well">
            <label><%= __('step2-ongoing')%></label>
          </div>
          <a id="addAddress" class="btn btn-info round" toggle="modal" data-target="#myModal" data-host="true" data-id="<%= user.host%>" data-href="/templates/user/address.html"><%= __('step2-action-btn')%></a>
          <%}%>

        </div>

        <div class="tab-pane fade" id="step3">

          <% if( hasDish ){%>
          <div class="well">
            <label><%= __('step3-success')%></label>
            <h4><small><%= __('step3-success-tip')%></small></h4>
          </div>
          <icon class="fa fa-check text-green"></icon>
          <button class="btn btn-default round next"><%= __('continue')%></button>
          <%}else{%>
          <div class="well">
            <label><%= __('step3-ongoing')%></label>
            <h4><small><%= __('step3-ongoing-tip')%></small></h4>
          </div>
          <a target="_blank" href="/host/me/createDish" class="btn btn-info round"><%= __('step3-action-btn')%></a>
          <%}%>

        </div>

        <div class="tab-pane fade" id="step4">

          <% if( hasMeal ){%>
          <div class="well">
            <label><%= __('step4-success')%></label>
            <h4><small><%= __('step4-success-tip')%></small></h4>
          </div>
          <icon class="fa fa-check text-green"></icon>
          <button class="btn btn-default round next"><%= __('continue')%></button>
          <%}else{%>
          <div class="well">
            <label><%= __('step4-ongoing')%></label>
            <h4><small><%= __('step4-ongoing-tip')%></small></h4>
          </div>
          <a target="_blank" href="/host/me/createMeal" class="btn btn-info round"><%= __('step4-action-btn')%></a>
          <%}%>

        </div>

        <div class="tab-pane fade" id="step5">

          <% if( hasAccount ){%>
          <div class="well">
            <label><%= __('step5-success')%></label>
            <h4><small><%= __('step5-success-tip')%></small></h4>
          </div>
          <icon class="fa fa-check text-green"></icon>
          <button class="btn btn-default round next"><%= __('continue')%></button>
          <%}else{%>
          <div class="well">
            <label><%= __('step5-ongoing')%></label>
            <h4><small><%= __('step5-ongoing-tip')%></small></h4>
          </div>
          <div class="row" style="margin-top: 20px;">
            <a target="_blank" href="/user/pocket#mypurse" class="btn btn-info round"><%= __('step5-action-btn')%></a>
          </div>
          <%}%>

        </div>

        <div class="tab-pane fade" id="step6">

          <% if( !verification ){%>
          <div class="well">
            <label><%= __('step6-success')%></label>
            <h4><small><%= __('step6-success-tip')%></small></h4>
          </div>
          <icon class="fa fa-check text-green"></icon>
          <a href="/host/me#mymeal" class="btn btn-default round"><%= __('complete')%></a>
          <%}else{%>
          <div class="well">
            <label><%= __('step6-ongoing')%>:<%= verification.disabled_reason%></label>
            <h4><small><%= __('step6-ongoing-tip')%></small></h4>
          </div>
          <form class="form" data-toggle="validator" role="form" enctype="multipart/form-data">
          <% verification.fields_needed.forEach(function(field){%>

              <% if(field == 'external_account'){%>
                <div class="form-group">
                  <label><%= __('needed')%>: <%= __('step5')%></label>
                  <a target="_blank" href="#step5" class="btn btn-info round"><%= __('goto')%><%= __('step5')%></a>
                </div>
              <%}else if(field == 'legal_entity.address.city'){%>
                <div class="form-group">
                  <label><%= __('needed')%>: <%= __('step2')%></label>
                  <a target="_blank" href="#step2" class="btn btn-info round"><%= __('goto')%><%= __('step2')%></a>
                </div>
              <%}else if(field == 'legal_entity.first_name'){%>
                <div class="form-group form-inline">
                  <label for="firstnameInput" class="control-label"><%= __('needed')%>: <%= __('firstname')%></label>
                  <input id="firstnameInput" type="text" class="form-control" placeholder="<%= __('firstname')%>" data-error="<%= __('cannot-empty')%>" required>
                  <div class="help-block with-errors"></div>
                </div>
              <%}else if(field == 'legal_entity.last_name'){%>
                <div class="form-group form-inline">
                  <label for="lastnameInput" class="control-label"><%= __('needed')%>: <%= __('lastname')%></label>
                  <input id="lastnameInput" type="text" class="form-control" placeholder="<%= __('lastname')%>" data-error="<%= __('cannot-empty')%>" required>
                  <div class="help-block with-errors"></div>
                </div>
              <%}else if(field == 'legal_entity.ssn_last_4'){%>
                <div class="form-group form-inline">
                  <label><%= __('social')%></label>
                  <input id="socialInput"  type="text" class="form-control" pattern="^\d{4}$" data-pattern-key="bad-format" data-pattern-error="bad format" data-error="<%= __('cannot-empty')%>" required>
                  <div class="help-block with-errors"></div>
                </div>
              <%}else if(field == 'legal_entity.dob.day'){%>
              <div class="form-group form-inline">
              <label><%= __('needed')%>: <%= __('birthday')%></label>
              <select id="bMonthInput" class="form-control" required>
                <option>01</option>
                <option>02</option>
                <option>03</option>
                <option>04</option>
                <option>05</option>
                <option>06</option>
                <option>07</option>
                <option>08</option>
                <option>09</option>
                <option>10</option>
                <option>11</option>
                <option>12</option>
              </select>
              <select id="bDayInput"  class="form-control" required>
                <option>01</option>
                <option>02</option>
                <option>03</option>
                <option>04</option>
                <option>05</option>
                <option>06</option>
                <option>07</option>
                <option>08</option>
                <option>09</option>
                <option>10</option>
                <option>11</option>
                <option>12</option>
                <option>13</option>
                <option>14</option>
                <option>15</option>
                <option>16</option>
                <option>17</option>
                <option>18</option>
                <option>19</option>
                <option>20</option>
                <option>21</option>
                <option>21</option>
                <option>22</option>
                <option>23</option>
                <option>24</option>
                <option>25</option>
                <option>26</option>
                <option>27</option>
                <option>28</option>
                <option>29</option>
                <option>30</option>
                <option>31</option>
              </select>
              <select id="bYearInput" class="form-control" required>
                <option>1940</option>
                <option>1941</option>
                <option>1942</option>
                <option>1943</option>
                <option>1944</option>
                <option>1945</option>
                <option>1946</option>
                <option>1947</option>
                <option>1948</option>
                <option>1949</option>
                <option>1950</option>
                <option>1951</option>
                <option>1952</option>
                <option>1953</option>
                <option>1954</option>
                <option>1955</option>
                <option>1956</option>
                <option>1957</option>
                <option>1958</option>
                <option>1959</option>
                <option>1960</option>
                <option>1961</option>
                <option>1962</option>
                <option>1963</option>
                <option>1964</option>
                <option>1965</option>
                <option>1966</option>
                <option>1967</option>
                <option>1968</option>
                <option>1969</option>
                <option>1970</option>
                <option>1971</option>
                <option>1972</option>
                <option>1973</option>
                <option>1974</option>
                <option>1975</option>
                <option>1976</option>
                <option>1977</option>
                <option>1978</option>
                <option>1979</option>
                <option>1980</option>
                <option>1981</option>
                <option>1982</option>
                <option>1983</option>
                <option>1984</option>
                <option>1985</option>
                <option>1986</option>
                <option>1987</option>
                <option>1988</option>
                <option>1989</option>
                <option>1990</option>
                <option>1991</option>
                <option>1992</option>
                <option>1993</option>
                <option>1994</option>
                <option>1995</option>
                <option>1996</option>
                <option>1997</option>
                <option>1998</option>
              </select>
              </div>
              <%}else if(field == "legal_entity.personal_id_number"){%>
                <div class="form-group form-inline">
                  <label><%= __('personal-id-number')%></label>
                  <input id="idNumberInput"  type="text" class="form-control" pattern="^\w{9,}$" data-pattern-key="bad-format" data-pattern-error="bad format" data-error="<%= __('cannot-empty')%>" required>
                  <div class="help-block with-errors"></div>
                </div>
              <%}else if(field == "legal_entity.verification.document"){%>
                <div class="form-group form-inline">
                  <label><%= __('personal-document')%></label>
                  <input id="documentInput" type="file" class="form-control" data-strictImage=true data-error="<%= __('cannot-empty')%>" required>
                  <div class="help-block with-errors"></div>
                </div>
              <%}else if(field.indexOf("legal_entity.dob") == -1 && field.indexOf("legal_entity.address")){%>
                <div class="form-group form-inline">
                  <label><%= field%></label>
                  <input type="text" class="form-control" pattern="^\w$" data-pattern-key="bad-format" data-pattern-error="bad format" data-error="<%= __('cannot-empty')%>" required>
                  <div class="help-block with-errors"></div>
                </div>
              <%}%>
          <%})%>
            <div id="additionalAlert" class="alert alert-danger"></div>
            <button id="additionalBtn" type="submit" class="btn btn-info"><%= __('save')%></button>
          </form>

          <%}%>

        </div>
      </div>
    </div>
  </div>
</div>

<script>

  $('.next').click(function(){
    var nextId = $(this).parents('.tab-pane').next().attr("id");
    $('[href=#'+nextId+']').tab('show');
    return false;
  })

  $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
    //update progress
    var step = $(e.target).data('step');
    var percent = (parseInt(step) / 6) * 100;
    $('.progress-bar').css({width: percent + '%'});

    <% if(req.getLocale() == 'zh'){%>
    $('.progress-bar').text("步骤 " + step + " / " + 6);
    <%}else{%>
    $('.progress-bar').text("step " + step + " of " + 6);
    <%}%>
    //e.relatedTarget // previous tab
  })
  setup();
  new ApplyView({el : $("#applyView"), model : new Host()});

</script>
