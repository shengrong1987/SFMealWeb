
<div class="d-flex justify-content-center pure-banner vertical-align red p-4">
  <div class="cursor-pointer mr-2">
    <a href="/" class="logo" style="left: 0;"></a>
  </div>
  <div>
    <h3 class="text-white text-left none-margin"><strong><%= __('nav-bar-pocket')%></strong></h3>
  </div>
</div>

  <div>
    <ul class="nav nav-tabs nav-fill bg-light pt-3">
      <li class="nav-item"><a class="nav-link active" data-toggle="tab" data-href="#mydetail"><%= __('pocket-detail')%></a></li>
      <li class="nav-item"><a class="nav-link" data-toggle="tab" role="tab" data-href="#mypurse"><%= __('pocket-bank')%></a></li>
      <li class="nav-item"><a class="nav-link" data-toggle="tab" role="tab" data-href="#mypayment"><%= __('pocket-payment')%></a></li>
    </ul>

    <div class="tab-content pt-2 pb-4" style="min-height: 500px;">

      <div id="mydetail" class="tab-pane active middle" style="width: 90%;">
        <div class="box box-shadow white">
          <div class="d-flex">

            <div class='input-group from mx-2' data-toggle="dateTimePicker">
              <div class="input-group-prepend"><span class="input-group-text"><%= __('date-from')%></span></div>
              <input type='text' class="form-control" />
              <div class="input-group-append">
                <span class="input-group-text"><i class="fa fa-calendar"></i></span>
              </div>
            </div>

            <div class='input-group to mx-2' data-toggle="dateTimePicker">
              <div class="input-group-prepend"><span class="input-group-text"><%= __('date-to')%></span></div>
              <input type='text' class="form-control" />
              <div class="input-group-append">
                <span class="input-group-text"><i class="fa fa-calendar"></i></span>
              </div>
            </div>

            <div id="durationBtn" data-target="#transaction_container" class="btn btn-blue do mx-2"><%= __('filter')%></div>
          </div>

          <div class="alert alert-warning" data-toggle="alert"><%= __('need-from-or-to-time')%></div>

          <div class="d-flex mt-3">
            <div class="btn-group btn-outline round border-blue rounded mx-auto">
              <input class="btn input" placeholder="<%= __('search-placeholder')%>">
              <button id="searchBtn" data-target="#transaction_container" class="btn white border-blue" style="border-top: none !important;border-bottom: none !important;border-right: none !important;">
                <i class="fa fa-search text-blue"></i>
              </button>
            </div>
          </div>

          <div class="row">
            <div class="col-12">
              <div class="btn-set">
                <button class="btn btn-grey-blue filter" type="button" data-filter="all">All</button>
                <button class="btn btn-grey-blue filter" type="button" data-filter=".comp"><%= __('type-compensation')%></button>
                <button class="btn btn-grey-blue filter" type="button" data-filter=".payment"><%= __('type-payment')%></button>
                <button class="btn btn-grey-blue filter" type="button" data-filter=".charge"><%= __('type-charge')%></button>
                <!--<button class="btn btn-info filter" type="button" data-filter=".fee"><%= __('type-fee')%></button>-->
              </div>
            </div>
          </div>

          <h1></h1>

          <div class="row">
            <div class="col-12">
              <h5 class="text-left"><strong><%= __('pocket-settled-bills')%></strong></h5>
            </div>
          </div>

          <div id="transaction_container" class="box-simple">

            <%
            user.pocket.transactions = user.pocket.transactions || [];
            for(var i = 0; i < user.pocket.transactions.length; i++) {
              var tranObj = user.pocket.transactions[i];
            if(tranObj.orderStatus !== "cancel" && (tranObj.status === "paid" || tranObj.status === "succeeded" || tranObj.status === "cash")){
            if(tranObj.type === "type-compensation" && !tranObj.reversed){
            %>
            <div class="mix comp" style="border-radius: 5px;display: block !important;" data-created="<%= tranObj.created%>" data-title="<%= tranObj.host.shopName%>">
              <div class="row vertical-align" style="padding:5px;">
                <div class="col-2"><%= tranObj.month%><br/><%= tranObj.day%></div>
                <div class="col-4"><%= __(tranObj.type) %>(<%= __(tranObj.paymentMethod || '')%>) <label><%= tranObj.metadata.orderId ? tranObj.metadata.orderId.slice(-4) : ''%></label> <i class="fa fa-question-circle white cursor-pointer" data-toggle="tooltip" title=<%= __('order-last-4')%>></i></div>
                <div class="col-3"><img class="img-thumbnail round_thumb size-small" src="<%= tranObj.host.picture || "/images/profile_man.png"%>" onclick="javascript:location.href='/host/public/<%= tranObj.host.id %>'">&nbsp;<%= tranObj.host.shopName%></div>
                <div class="col-3"><b>$<%= tranObj.amount/100 %></b> ( <%= __('compensation-amount')%>: $<%= Math.round(tranObj.amount)/100 %>)</div>
              </div>
            </div>
            <%}else if(tranObj.type === 'type-payment'){var refund = tranObj.amount_refunded;%>
            <div class="mix payment" style="border-radius: 5px;display: block !important;;" data-created="<%= tranObj.created%>" data-title="<%= tranObj.host.shopName%>">
              <div class="row vertical-align" style="padding:5px;">
                <div class="col-2"><%= tranObj.month%><br/><%= tranObj.day%></div>
                <div class="col-4"><%= __(tranObj.type) %>(<%= __(tranObj.paymentMethod || '')%>) <label><%= tranObj.metadata.orderId.slice(-4)%></label> <i class="fa fa-question-circle white cursor-pointer" data-toggle="tooltip" title=<%= __('order-last-4')%>></i></div>
                <div class="col-3"><img class="img-thumbnail round_thumb size-small" src="<%= tranObj.host.picture || "/images/profile_man.png"%>" onclick="javascript:location.href='/host/public/<%= tranObj.host.id %>'">&nbsp;<%= tranObj.host.shopName%></div>
                <div class="col-3"><b>$<%= (tranObj.amount - refund - tranObj.application_fee - tranObj.tip*100)/100%></b> ( <%= __('order-fee')%>: $<%= Math.round(tranObj.amount - tranObj.deliveryFee * 100 - tranObj.metadata.tax - tranObj.tip*100)/100 %> + <%= __('tax')%>: $<%= tranObj.metadata.tax/100%> + <%= __('delivery-fee')%>: $<%= tranObj.deliveryFee%> - <%= __('application_fee')%>: $<%= tranObj.application_fee/100%><%= refund ? " - " + __('refunded')+ ": $" + refund/100 : "" %> )</div>
              </div>
            </div>
            <%}else if(tranObj.type === 'type-charge'){var refund = tranObj.amount_refunded;%>
            <div class="mix charge" style="border-radius: 5px;display: block !important;;" data-created="<%= tranObj.created%>" data-title="<%= tranObj.host.shopName%>">
              <div class="row vertical-align" style="padding:5px;">
                <div class="col-2"><%= tranObj.month%><br/><%= tranObj.day%></div>
                <div class="col-4"><%= __(tranObj.type) %>(<%= __(tranObj.paymentMethod || '')%>) <label><%= tranObj.metadata.orderId.slice(-4)%></label> <i class="fa fa-question-circle white cursor-pointer" data-toggle="tooltip" title=<%= __('order-last-4')%>></i></div>
                <div class="col-3"><img class="img-thumbnail round_thumb size-small" src="<%= tranObj.host.picture || "/images/profile_man.png"%>" onclick="javascript:location.href='/host/public/<%= tranObj.host.id %>'">&nbsp;<%= tranObj.host.shopName%></div>
                <div class="col-3"><b>$<%= (tranObj.amount - refund)/100%></b> ( <%= __('order-fee')%>: $<%= Math.round(tranObj.amount - tranObj.deliveryFee * 100 - tranObj.metadata.tax)/100 %> + <%= __('tax')%>: $<%= tranObj.metadata.tax/100%> + <%= __('delivery-fee')%>: $<%= tranObj.deliveryFee%> <%= refund ? " - " + __('refunded')+ ": $" + refund/100 : "" %> )</div>
              </div>
            </div>
            <%}}}%>

          </div>

          <div class="mixitup-page-list"></div>
          <div class="mixitup-page-stats"></div>

          <!--<nav class="pull-right">-->
          <!--<ul class="pagination pagination-sm" data-trigger="pagination" data-target="#transaction_container" data-npp="20">-->
          <!--<li class="active"><a href="javascript:void(0)">1</a></li>-->
          <!--</ul>-->
          <!--</nav>-->

          <div class="middle mt-2">
            <div class="btn btn-outline border-blue white text-blue"><strong><%= __('see-all')%></strong></div>
          </div>
        </div>
      </div>
      <!-- mypurse end -->

      <div id="mypurse" style="width: 90%;" class="tab-pane middle">
        <div class="box box-shadow white">
          <% if(typeof host != 'undefined' && host){%>
          <h4 class="text-left"><%= __('pocket-my-bank')%>: <small class="bank_name"></small>
            <% if (host.bankId){%>
            <small><a toggle="modal" data-updating="true" data-host="<%= host.id%>" data-target="#myModal" data-href="/templates/user/bank.html" href="javascript:void(0)" onclick="toggleModal(event,enterHostInfo)">  <%= __('bank-update')%> </a></small><i class="fa fa-question-circle text-grey cursor-pointer"></i>
            <%}else{%>
            <small><a toggle="modal" data-updating="false" data-host="<%= host.id%>" data-target="#myModal" data-href="/templates/user/bank.html" href="javascript:void(0)" onclick="toggleModal(event,enterHostInfo)">  <%= __('bank-new')%> </a></small><i class="fa fa-question-circle text-grey cursor-pointer"></i>
            <%}%>
          </h4>
          <h4 class="text-left"><%= __('pocket-my-balance')%>:</h4>
          <div class="jumbotron">
            <h1 class="text-blue">$<%= user.pocket.balance%></h1>
          </div>
          <!--<button class="btn btn-primary btn-lg round blue">申请提款</button>-->
          <%}%>
        </div>
      </div>

      <div id="mypayment" style="width: 90%;" class="tab-pane middle" data-id="<%= user.id %>">
        <div class="box box-shadow white">
          <%
          var cards = user.payment;
          for(var j=0; j < cards.length; j++){
            var card = cards[j];
            var last4 = card.last4;
          if(card.isDefaultPayment){
          %>
          <button class="btn btn-disable blue btn-fat btn-lg active" style="margin-right: 10px;height: 80px;" toggle="modal" data-target="#myModal" data-href="/payment/<%= card.id%>" onclick="toggleModal(event)"><strong><%= card.brand %><br/><%= last4 %></strong></button>
          <%}else{%>
          <button class="btn btn-disable btn-fat btn-lg<%if(card.isDefaultPayment){%> active<%}%>" style="margin-right: 10px;height: 80px;" toggle="modal" data-target="#myModal" data-href="/payment/<%=card.id%>" onclick="toggleModal(event)"><strong><%= card.brand %><br/><%= last4 %></strong></button>
          <%}}%>
          <button class="btn btn-disable btn-fat btn-lg" style="margin-right: 10px;height: 80px;" toggle="modal" data-target="#myModal" data-href="/payment/new" onclick="toggleModal(event)"><strong><i class="fa fa-plus fa-2x"></i></strong><br/><%= __('card-new')%></button>
        </div>
      </div>
      <!-- payment end -->
    </div>
  </div>

</div>

<script>
  new TransactionView({ el : $("#mydetail"), model : new Transaction()});
</script>
