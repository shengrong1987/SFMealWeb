
<div class="container-fluid text-center" style="margin-top:-20px;">
  <div class="row">
    <div class="pure-banner vertical-align green">
      <div style="width: 600px;" class="middle banner-text">
        <div class="row vertical-align" style="margin-bottom: 5px;">
          <div class="col-sm-3">
            <a href="/" class="logo logo-sm"></a>
          </div>
          <div class="col-sm-9">
            <h4 class="text-white"><strong>欢迎加入我们,一起享受私房菜吧！</strong></h4>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row">

    <div class="default-container">
      <% if(!user.host.passGuide){%>
      <div class="col-xs-12 box">
        <div class="alert alert-info">欢迎来到厨师管理页面, 点击这里会帮助您建立并发布菜单. <a class="btn btn-info" style="margin-left:10px;" href="/apply">厨师发布引导</a></div>
      </div>
      <%}%>
      <ul class="nav nav-tab-green nav-justified" style="padding: 20px;">
        <li class="active"><a data-toggle="tab" href="#myorder"><h4><strong>厨房订单</strong></h4></a></li>
        <li><a data-toggle="tab" href="#mymeal"><h4><strong>我的Meal</strong></h4></a></li>
        <li><a data-toggle="tab" href="#mydish"><h4><strong>我的菜</strong></h4></a></li>
        <li><a data-toggle="tab" href="#myinfo"><h4><strong>编辑厨房资料</strong></h4></a></li>
      </ul>

      <div class="tab-content" style="padding-top: 20px;padding-bottom: 60px;">
        <div id="myorder" style="width: 90%;" class="tab-pane middle active">
          <div class="box box-shadow white">
            <ul class="nav nav-justified nav-tab-green" style="padding: 20px;">
              <li class="active"><a data-toggle="tab" href="#myorder-order"><h4><strong>即点订单</strong></h4></a></li>
              <li><a data-toggle="tab" href="#myorder-preorder"><h4><strong>预售订单</strong></h4></a></li>
            </ul>
            <div class="tab-content">
              <div id="myorder-order" style="width: 90%;" class="tab-pane middle active">
                <ul class="nav nav-tabs" style="margin-top: 20px;margin-bottom: 10px;">
                  <li class="active"><a data-toggle="tab" href="#order-all" class="btn-lg text-dark"><strong>所有订单</strong></a></li>
                  <li><a data-toggle="tab" href="#order-holding" class="btn-lg text-dark"><strong>待确认</strong></a></li>
                  <li><a data-toggle="tab" href="#order-schedule" class="btn-lg text-dark"><strong>待煮</strong></a></li>
                  <li><a data-toggle="tab" href="#order-preparing" class="btn-lg text-dark"><strong>烹饪中</strong></a></li>
                  <li><a data-toggle="tab" href="#order-prepared" class="btn-lg text-dark"><strong>等自取/送餐中</strong></a></li>
                  <li><a data-toggle="tab" href="#order-delivered" class="btn-lg text-dark"><strong>已完成</strong></a></li>
                  <li><a data-toggle="tab" href="#order-reviewed" class="btn-lg text-dark"><strong>已评价</strong></a></li>
                </ul>
                <div class="tab-content">
                  <div id="order-all" class="tab-pane middle active">
                    <table class="table table-bordered" style="width: 100%;">
                      <thead>
                      <tr>
                        <td>照片</td>
                        <td>私房菜</td>
                        <td>单价</td>
                        <td>数量</td>
                        <td>实付款</td>
                        <td>状态</td>
                        <td>交易操作</td>
                      </tr>
                      </thead>
                      <%
                        var host = user.host;
                        host.host_orders.forEach(function(order){
                          if(order.type=="order"){
                      %>
                      <tbody class="item">
                        <tr class="active">
                          <td align="left" colspan="7">&nbsp&nbsp&nbsp&nbsp&nbsp<%= order.updatedAt%>&nbsp&nbsp&nbsp&nbsp&nbsp订单号:<%= order.id%>&nbsp&nbsp&nbsp&nbsp&nbsp厨师: <a href="/host/<%= host.id%>"><%= host.shopName%></a></td>
                        </tr>
                      <%
                          var list = Object.keys(order.orders);
                          var dishes = host.host_dishes;
                          var index = -1;
                          list.forEach(function(key){
                            var number = order.orders[key];
                            dishes.forEach(function(dish){
                              if(dish.id == key){
                                index++;
                      %>
                        <tr>
                          <td><img src="<%= dish.photos[0].v%>" style="width: 150px;"></td>
                          <td><%= dish.title%></td>
                          <td>$<%= dish.price.toFixed(2)%></td>
                          <td><% if(order.status=="adjust"){
                              var adjustingNumber = order.adjusting_orders[key];
                              if(adjustingNumber != number){%>
                            <%= number%> to <strong><%= adjustingNumber%></strong>
                            <%}else{%>
                            <%= number%>
                            <%}}else{%>
                            <%= number%>
                            <%}%></td>
                          <%if(index==0){%>
                          <td rowspan="<%= list.length%>" style="vertical-align: middle;">$<%= order.subtotal.toFixed(2)%><br>含送餐费<br>($<%= order.delivery_fee.toFixed(2)%>)</td>
                          <td rowspan="<%= list.length%>" style="vertical-align: middle;"><%= order.statusText()%></td>
                          <td rowspan="<%= list.length%>" style="vertical-align: middle;">
                            <% if(order.status == "schedule"){ %>
                            <a href="javascript:void(0)" data-action="cancel" data-order="<%= order.id%>">取消</a><br/>
                            <a data-target="#myModal" toggle="modal" href="javascript:void(0)" onclick="javascript:toggleModal(event)" data-href="/order/<%= order.id%>/adjust-form">调整</a><br/>
                            <a href="#">联系吃货</a>
                            <%}else if(order.status == "adjust" || order.status == "canceling") {%>
                            <a href="javascript:void(0)" data-action="confirm" data-order="<%= order.id%>">确认</a><br/>
                            <a data-toggle="alert-button" data-title="拒绝原因" data-content="原因" data-actionFn="javascript:orderView.reject" data-argument="<%= order.id%>">拒绝</a><br/>
                            <a href="#">联系吃货</a>
                            <%}else if(order.status == "preparing"){%>
                            <a href="javascript:void(0)" data-action="ready" data-order="<%= order.id%>">完成</a><br/>
                            <a data-target="#myModal" toggle="modal" href="javascript:void(0)" onclick="javascript:toggleModal(event)" data-href="/order/<%= order.id%>/adjust-form">调整</a><br/>
                            <a href="#">联系吃货</a>
                            <%}else if(order.status == "ready"){%>
                            <a href="javascript:void(0)" data-action="receive" data-order="<%= order.id%>">确认取货</a><br/>
                            <a href="#">联系吃货</a>
                            <%}else if(order.status == "review"){%>

                            <%}else if(order.status == "complete"){%>
                            <a href="/meal/<%= order.meal%>">查看评价</a>
                            <%}%>
                          </td>
                        </tr>
                        <%}%>
                      <%}})})%>
                      </tbody>
                      <%}})%>
                    </table>
                    <nav class="pull-right">
                      <ul class="pagination pagination-green pagination-sm" data-trigger="pagination" data-target="#order-all">
                        <li class="active"><a href="javascript:void(0)">1</a></li>
                      </ul>
                    </nav>
                  </div>

                  <div id="order-holding" class="tab-pane middle">
                    <table class="table table-bordered">
                      <thead>
                      <tr>
                        <td>照片</td>
                        <td>私房菜</td>
                        <td>单价</td>
                        <td>数量</td>
                        <td>实付款</td>
                        <td>状态</td>
                        <td>交易操作</td>
                      </tr>
                      </thead>
                      <%
                      var host = user.host;
                          host.host_orders.forEach(function(order){
                      if(order.type == "order" && (order.status == "adjust" || order.status == "canceling")){
                      %>
                      <tbody class="item">
                      <tr class="active">
                        <td align="left" colspan="7">&nbsp&nbsp&nbsp&nbsp&nbsp<%= order.updatedAt%>&nbsp&nbsp&nbsp&nbsp&nbsp订单号:<%= order.id%>&nbsp&nbsp&nbsp&nbsp&nbsp厨师: <a href="/host/<%= host.id%>"><%= host.shopName%></a></td>
                      </tr>
                      <%
                        var list = Object.keys(order.orders);
                        var dishes = host.host_dishes;
                        var index = -1;
                          list.forEach(function(key){
                          var number = order.orders[key];
                          dishes.forEach(function(dish){
                            if(dish.id == key){
                            index++;
                      %>
                      <tr>
                        <td><img src="<%= dish.photos[0].v%>" style="width: 150px;"></td>
                        <td><%= dish.title%></td>
                        <td>$<%= dish.price.toFixed(2)%></td>
                        <td><%= number%></td>
                        <%if(index==0){%>
                        <td rowspan="<%= list.length%>" style="vertical-align: middle;">$<%= order.subtotal.toFixed(2)%><br>含送餐费<br>($<%= order.delivery_fee.toFixed(2)%>)</td>
                        <td rowspan="<%= list.length%>" style="vertical-align: middle;"><%= order.statusText()%></td>
                        <td rowspan="<%= list.length%>" style="vertical-align: middle;">
                          <a href="javascript:void(0)" data-action="confirm" data-order="<%= order.id%>">确认</a><br/>
                          <a data-toggle="alert-button" data-title="拒绝原因" data-content="原因" data-actionFn="rejectOrder" data-argument="<%= order.id%>">拒绝</a><br/>
                          <a href="#">联系吃货</a>
                        </td>
                      </tr>
                      <%}%>
                      <%}})})%>
                      </tbody>
                      <%}})%>
                    </table>
                    <nav class="pull-right">
                      <ul class="pagination pagination-green pagination-sm" data-trigger="pagination" data-target="#order-holding">
                        <li class="active"><a href="javascript:void(0)">1</a></li>
                      </ul>
                    </nav>
                  </div>

                  <div id="order-schedule" class="tab-pane middle">
                    <table id="order-schedule" class="table table-bordered" style="width: 100%;">
                      <thead>
                      <tr>
                        <td>照片</td>
                        <td>私房菜</td>
                        <td>单价</td>
                        <td>数量</td>
                        <td>实付款</td>
                        <td>状态</td>
                        <td>交易操作</td>
                      </tr>
                      </thead>
                      <%
                      var host = user.host;
                          host.host_orders.forEach(function(order){
                            if(order.type == "order" && order.status == "schedule"){
                      %>
                      <tbody class="item">
                      <tr class="active">
                        <td align="left" colspan="7">&nbsp&nbsp&nbsp&nbsp&nbsp<%= order.updatedAt%>&nbsp&nbsp&nbsp&nbsp&nbsp订单号:<%= order.id%>&nbsp&nbsp&nbsp&nbsp&nbsp厨师: <a href="/host/<%= host.id%>"><%= host.shopName%></a></td>
                      </tr>
                      <%
                        var list = Object.keys(order.orders);
                        var dishes = host.host_dishes;
                        var index = -1;
                          list.forEach(function(key){
                            var number = order.orders[key];
                            dishes.forEach(function(dish){
                            if(dish.id == key){
                              index++;
                      %>
                      <tr>
                        <td><img src="<%= dish.photos[0].v%>" style="width: 150px;"></td>
                        <td><%= dish.title%></td>
                        <td>$<%= dish.price.toFixed(2)%></td>
                        <td><%= number%></td>
                        <%if(index==0){%>
                        <td rowspan="<%= list.length%>" style="vertical-align: middle;">$<%= order.subtotal.toFixed(2)%><br>含送餐费<br>($<%= order.delivery_fee.toFixed(2)%>)</td>
                        <td rowspan="<%= list.length%>" style="vertical-align: middle;"><%= order.statusText()%></td>
                        <td rowspan="<%= list.length%>" style="vertical-align: middle;">
                          <a href="javascript:void(0)" data-action="cancel" data-order="<%= order.id%>">取消</a><br/>
                          <a data-target="#myModal" toggle="modal" href="javascript:void(0)" onclick="javascript:toggleModal(event)" data-href="/order/<%= order.id%>/adjust-form">调整</a><br/>
                          <a href="#">联系吃货</a>
                        </td>
                      </tr>
                      <%}%>
                      <%}})})%>
                      </tbody>
                      <%}})%>
                    </table>
                    <nav class="pull-right">
                      <ul class="pagination pagination-green pagination-sm" data-trigger="pagination" data-target="#order-schedule">
                        <li class="active"><a href="javascript:void(0)">1</a></li>
                      </ul>
                    </nav>
                  </div>

                  <div id="order-preparing" class="tab-pane middle">
                    <table class="table table-bordered">
                      <thead>
                      <tr>
                        <td>照片</td>
                        <td>私房菜</td>
                        <td>单价</td>
                        <td>数量</td>
                        <td>实付款</td>
                        <td>状态</td>
                        <td>交易操作</td>
                      </tr>
                      </thead>
                      <%
                      var host = user.host;
                          host.host_orders.forEach(function(order){
                      if(order.type == "order" && order.status == "preparing"){
                      %>
                      <tbody class="item">
                      <tr class="active">
                        <td align="left" colspan="7">&nbsp&nbsp&nbsp&nbsp&nbsp<%= order.updatedAt%>&nbsp&nbsp&nbsp&nbsp&nbsp订单号:<%= order.id%>&nbsp&nbsp&nbsp&nbsp&nbsp厨师: <a href="/host/<%= host.id%>"><%= host.shopName%></a></td>
                      </tr>
                      <%
                        var list = Object.keys(order.orders);
                        var dishes = host.host_dishes;
                        var index = -1;
                          list.forEach(function(key){
                        var number = order.orders[key];
                          dishes.forEach(function(dish){
                      if(dish.id == key){
                        index++;
                      %>
                      <tr>
                        <td><img src="<%= dish.photos[0].v%>" style="width: 150px;"></td>
                        <td><%= dish.title%></td>
                        <td>$<%= dish.price.toFixed(2)%></td>
                        <td><%= number%></td>
                        <%if(index==0){%>
                        <td rowspan="<%= list.length%>" style="vertical-align: middle;">$<%= order.subtotal.toFixed(2)%><br>含送餐费<br>($<%= order.delivery_fee.toFixed(2)%>)</td>
                        <td rowspan="<%= list.length%>" style="vertical-align: middle;"><%= order.statusText()%></td>
                        <td rowspan="<%= list.length%>" style="vertical-align: middle;">
                          <a href="javascript:void(0)" data-action="ready" data-order="<%= order.id%>">完成</a><br/>
                          <a data-target="#myModal" toggle="modal" href="javascript:void(0)" onclick="javascript:toggleModal(event)" data-href="/order/<%= order.id%>/adjust-form">调整</a><br/>
                          <a href="#">联系吃货</a>
                        </td>
                      </tr>
                      <%}%>
                      <%}})})%>
                      </tbody>
                      <%}})%>
                    </table>
                    <nav class="pull-right">
                      <ul class="pagination pagination-green pagination-sm" data-trigger="pagination" data-target="#order-preparing">
                        <li class="active"><a href="javascript:void(0)">1</a></li>
                      </ul>
                    </nav>
                  </div>

                  <div id="order-prepared" class="tab-pane middle">
                    <table class="table table-bordered" style="width: 100%;">
                      <thead>
                      <tr>
                        <td>照片</td>
                        <td>私房菜</td>
                        <td>单价</td>
                        <td>数量</td>
                        <td>实付款</td>
                        <td>状态</td>
                        <td>交易操作</td>
                      </tr>
                      </thead>
                      <%
                      var host = user.host;
                          host.host_orders.forEach(function(order){
                      if(order.type == "order" && order.status == "ready"){
                      %>
                      <tbody class="item">
                      <tr class="active">
                        <td align="left" colspan="7">&nbsp&nbsp&nbsp&nbsp&nbsp<%= order.updatedAt%>&nbsp&nbsp&nbsp&nbsp&nbsp订单号:<%= order.id%>&nbsp&nbsp&nbsp&nbsp&nbsp厨师: <a href="/host/<%= host.id%>"><%= host.shopName%></a></td>
                      </tr>
                      <%
                        var list = Object.keys(order.orders);
                        var dishes = host.host_dishes;
                        var index = -1;
                          list.forEach(function(key){
                            var number = order.orders[key];
                            dishes.forEach(function(dish){
                            if(dish.id == key){
                              index++;
                      %>
                      <tr>
                        <td><img src="<%= dish.photos[0].v%>" style="width: 150px;"></td>
                        <td><%= dish.title%></td>
                        <td>$<%= dish.price.toFixed(2)%></td>
                        <td><%= number%></td>
                        <%if(index==0){%>
                        <td rowspan="<%= list.length%>" style="vertical-align: middle;">$<%= order.subtotal.toFixed(2)%><br>含送餐费<br>($<%= order.delivery_fee.toFixed(2)%>)</td>
                        <td rowspan="<%= list.length%>" style="vertical-align: middle;"><%= order.statusText()%></td>
                        <td rowspan="<%= list.length%>" style="vertical-align: middle;">
                          <a href="javascript:void(0)" data-action="receive" data-order="<%= order.id%>">确认取货</a><br/>
                      </tr>
                      <%}%>
                      <%}})})%>
                      </tbody>
                      <%}})%>
                    </table>
                    <nav class="pull-right">
                      <ul class="pagination pagination-green pagination-sm" data-trigger="pagination" data-target="#order-prepared">
                        <li class="active"><a href="javascript:void(0)">1</a></li>
                      </ul>
                    </nav>
                  </div>


                  <div id="order-delivered" class="tab-pane middle">
                    <table class="table table-bordered" style="width: 100%;">
                      <thead>
                      <tr>
                        <td>照片</td>
                        <td>私房菜</td>
                        <td>单价</td>
                        <td>数量</td>
                        <td>实付款</td>
                        <td>状态</td>
                        <td>交易操作</td>
                      </tr>
                      </thead>
                      <%
                      var host = user.host;
                          host.host_orders.forEach(function(order){
                      if(order.type == "order" && order.status == "review"){
                      %>
                      <tbody class="item">
                      <tr class="active">
                        <td align="left" colspan="7">&nbsp&nbsp&nbsp&nbsp&nbsp<%= order.updatedAt%>&nbsp&nbsp&nbsp&nbsp&nbsp订单号:<%= order.id%>&nbsp&nbsp&nbsp&nbsp&nbsp厨师: <a href="/host/<%= host.id%>"><%= host.shopName%></a></td>
                      </tr>
                      <%
                        var list = Object.keys(order.orders);
                        var dishes = host.host_dishes;
                        var index = -1;
                          list.forEach(function(key){
                            var number = order.orders[key];
                            dishes.forEach(function(dish){
                              if(dish.id == key){
                                index++;
                      %>
                      <tr>
                        <td><img src="<%= dish.photos[0].v%>" style="width: 150px;"></td>
                        <td><%= dish.title%></td>
                        <td>$<%= dish.price.toFixed(2)%></td>
                        <td><%= number%></td>
                        <%if(index==0){%>
                        <td rowspan="<%= list.length%>" style="vertical-align: middle;">$<%= order.subtotal.toFixed(2)%><br>含送餐费<br>($<%= order.delivery_fee.toFixed(2)%>)</td>
                        <td rowspan="<%= list.length%>" style="vertical-align: middle;"><%= order.statusText()%></td>
                        <td rowspan="<%= list.length%>" style="vertical-align: middle;">
                        </td>
                      </tr>
                      <%}%>
                      <%}})})%>
                      </tbody>
                      <%}})%>
                    </table>
                    <nav class="pull-right">
                      <ul class="pagination pagination-green pagination-sm" data-trigger="pagination" data-target="#order-delivered">
                        <li class="active"><a href="javascript:void(0)">1</a></li>
                      </ul>
                    </nav>
                  </div>

                  <div id="order-reviewed" class="tab-pane middle">
                    <table class="table table-bordered" style="width: 100%;">
                      <thead>
                      <tr>
                        <td>照片</td>
                        <td>私房菜</td>
                        <td>单价</td>
                        <td>数量</td>
                        <td>实付款</td>
                        <td>状态</td>
                        <td>交易操作</td>
                      </tr>
                      </thead>
                      <%
                      var host = user.host;
                          host.host_orders.forEach(function(order){
                      if(order.type == "order" && order.status == "complete"){
                      %>
                      <tbody class="item">
                      <tr class="active">
                        <td align="left" colspan="7">&nbsp&nbsp&nbsp&nbsp&nbsp<%= order.updatedAt%>&nbsp&nbsp&nbsp&nbsp&nbsp订单号:<%= order.id%>&nbsp&nbsp&nbsp&nbsp&nbsp厨师: <a href="/host/<%= host.id%>"><%= host.shopName%></a></td>
                      </tr>
                      <%
                        var list = Object.keys(order.orders);
                        var dishes = host.host_dishes;
                        var index = -1;
                          list.forEach(function(key){
                            var number = order.orders[key];
                            dishes.forEach(function(dish){
                              if(dish.id == key){
                                index++;
                      %>
                      <tr>
                        <td><img src="<%= dish.photos[0].v%>" style="width: 150px;"></td>
                        <td><%= dish.title%></td>
                        <td>$<%= dish.price.toFixed(2)%></td>
                        <td><%= number%></td>
                        <%if(index==0){%>
                        <td rowspan="<%= list.length%>" style="vertical-align: middle;">$<%= order.subtotal.toFixed(2)%><br>含送餐费<br>($<%= order.delivery_fee.toFixed(2)%>)</td>
                        <td rowspan="<%= list.length%>" style="vertical-align: middle;"><%= order.statusText()%></td>
                        <td rowspan="<%= list.length%>" style="vertical-align: middle;">
                          <a href="/meal/<%= order.meal%>">查看评价</a>
                        </td>
                      </tr>
                      <%}%>
                      <%}})})%>
                      </tbody>
                      <%}})%>
                    </table>
                    <nav class="pull-right">
                      <ul class="pagination pagination-green pagination-sm" data-trigger="pagination" data-target="#order-reviewed">
                        <li class="active"><a href="javascript:void(0)">1</a></li>
                      </ul>
                    </nav>
                  </div>

                </div>
              </div>

              <div id="myorder-preorder" style="width: 90%;" class="tab-pane middle">
                <ul class="nav nav-tabs" style="margin-top: 20px;margin-bottom: 10px;">
                  <li class="active"><a data-toggle="tab" href="#preorder-all" class="btn-lg text-dark"><strong>所有订单</strong></a></li>
                  <li><a data-toggle="tab" href="#preorder-holding" class="btn-lg text-dark"><strong>待确认</strong></a></li>
                  <li><a data-toggle="tab" href="#preorder-schedule" class="btn-lg text-dark"><strong>待煮</strong></a></li>
                  <li><a data-toggle="tab" href="#preorder-preparing" class="btn-lg text-dark"><strong>烹饪中</strong></a></li>
                  <li><a data-toggle="tab" href="#preorder-ready" class="btn-lg text-dark"><strong>等自取/送餐中</strong></a></li>
                  <li><a data-toggle="tab" href="#preorder-delivered" class="btn-lg text-dark"><strong>已完成</strong></a></li>
                  <li><a data-toggle="tab" href="#preorder-reviewed" class="btn-lg text-dark"><strong>已评价</strong></a></li>
                </ul>
                <div class="tab-content">
                  <div id="preorder-all" class="tab-pane middle active">
                    <table class="table table-bordered" style="width: 100%;">
                      <thead>
                      <tr>
                        <td>照片</td>
                        <td>私房菜</td>
                        <td>单价</td>
                        <td>数量</td>
                        <td>实付款</td>
                        <td>状态</td>
                        <td>交易操作</td>
                      </tr>
                      </thead>
                      <%
                      var host = user.host;
                          host.host_orders.forEach(function(order){
                      if(order.type=="preorder"){
                      %>
                      <tbody class="item">
                      <tr class="active">
                        <td align="left" colspan="7">&nbsp&nbsp&nbsp&nbsp&nbsp<%= order.updatedAt%>&nbsp&nbsp&nbsp&nbsp&nbsp订单号:<%= order.id%>&nbsp&nbsp&nbsp&nbsp&nbsp厨师: <a href="/host/<%= host.id%>"><%= host.shopName%></a></td>
                      </tr>
                      <%
                        var list = Object.keys(order.orders);
                        var dishes = host.host_dishes;
                        var index = -1;
                          list.forEach(function(key){
                        var number = order.orders[key];
                          dishes.forEach(function(dish){
                      if(dish.id == key){
                        index++;
                      %>
                      <tr>
                        <td><img src="<%= dish.photos[0].v%>" style="width: 150px;"></td>
                        <td><%= dish.title%></td>
                        <td>$<%= dish.price.toFixed(2)%></td>
                        <td><%= number%></td>
                        <%if(index==0){%>
                        <td rowspan="<%= list.length%>" style="vertical-align: middle;">$<%= order.subtotal.toFixed(2)%><br>含送餐费<br>($<%= order.delivery_fee.toFixed(2)%>)</td>
                        <td rowspan="<%= list.length%>" style="vertical-align: middle;"><%= order.statusText()%></td>
                        <td rowspan="<%= list.length%>" style="vertical-align: middle;">
                          <% if(order.status == "schedule"){ %>
                          <a href="javascript:void(0)" data-action="cancel" data-order="<%= order.id%>">取消</a><br/>
                          <a data-target="#myModal" toggle="modal" href="javascript:void(0)" onclick="javascript:toggleModal(event)" data-href="/order/<%= order.id%>/adjust-form">调整</a><br/>
                          <a href="#">联系吃货</a>
                          <%}else if(order.status == "adjust" || order.status == "canceling") {%>
                          <a href="javascript:void(0)" data-action="confirm" data-order="<%= order.id%>">确认</a><br/>
                          <a data-toggle="alert-button" data-title="拒绝原因" data-content="原因" data-actionFn="rejectOrder" data-argument="<%= order.id%>">拒绝</a><br/>
                          <a href="#">联系吃货</a>
                          <%}else if(order.status == "preparing"){%>
                          <a href="javascript:void(0)" data-action="ready" data-order="<%= order.id%>">完成</a>
                          <a data-target="#myModal" toggle="modal" href="javascript:void(0)" onclick="javascript:toggleModal(event)" data-href="/order/<%= order.id%>/adjust-form">调整</a><br/>
                          <a href="#">联系吃货</a>
                          <%}else if(order.status == "ready"){%>
                          <a href="javascript:void(0)" data-action="receive" data-order="<%= order.id%>">确认取货</a><br/>
                          <a href="#">联系吃货</a>
                          <%}else if(order.status == "review"){%>
                          <%}else if(order.status == "complete"){%>
                          <a href="/meal/<%= order.meal%>">查看评价</a>
                          <%}%>
                        </td>
                      </tr>
                      <%}}})})%>
                      </tbody>
                      <%}})%>
                    </table>
                    <nav class="pull-right">
                      <ul class="pagination pagination-green pagination-sm" data-trigger="pagination" data-target="#preorder-all">
                        <li class="active"><a href="javascript:void(0)">1</a></li>
                      </ul>
                    </nav>
                  </div>

                  <div id="preorder-holding" class="tab-pane middle">
                    <table class="table table-bordered">
                      <thead>
                      <tr>
                        <td>照片</td>
                        <td>私房菜</td>
                        <td>单价</td>
                        <td>数量</td>
                        <td>实付款</td>
                        <td>状态</td>
                        <td>交易操作</td>
                      </tr>
                      </thead>
                      <%
                      var host = user.host;
                          host.host_orders.forEach(function(order){
                      if(order.type == "preorder" && (order.status == "adjust" || order.status == "canceling")){
                      %>
                      <tbody class="item">
                      <tr class="active">
                        <td align="left" colspan="7">&nbsp&nbsp&nbsp&nbsp&nbsp<%= order.updatedAt%>&nbsp&nbsp&nbsp&nbsp&nbsp订单号:<%= order.id%>&nbsp&nbsp&nbsp&nbsp&nbsp厨师: <a href="/host/<%= host.id%>"><%= host.shopName%></a></td>
                      </tr>
                      <%
                        var list = Object.keys(order.orders);
                        var dishes = host.host_dishes;
                        var index = -1;
                          list.forEach(function(key){
                        var number = order.orders[key];
                          dishes.forEach(function(dish){
                      if(dish.id == key){
                        index++;
                      %>
                      <tr>
                        <td><img src="<%= dish.photos[0].v%>" style="width: 150px;"></td>
                        <td><%= dish.title%></td>
                        <td>$<%= dish.price.toFixed(2)%></td>
                        <td><%= number%></td>
                        <%if(index==0){%>
                        <td rowspan="<%= list.length%>" style="vertical-align: middle;">$<%= order.subtotal.toFixed(2)%><br>含送餐费<br>($<%= order.delivery_fee.toFixed(2)%>)</td>
                        <td rowspan="<%= list.length%>" style="vertical-align: middle;"><%= order.statusText()%></td>
                        <td rowspan="<%= list.length%>" style="vertical-align: middle;">
                          <a href="javascript:void(0)" data-action="confirm" data-order="<%= order.id%>">确认</a><br/>
                          <a data-toggle="alert-button" data-title="拒绝原因" data-content="原因" data-actionFn="rejectOrder" data-argument="<%= order.id%>">拒绝</a><br/>
                          <a href="#">联系吃货</a>
                        </td>
                      </tr>
                      <%}%>
                      <%}})})%>
                      </tbody>
                      <%}})%>
                    </table>
                    <nav class="pull-right">
                      <ul class="pagination pagination-green pagination-sm" data-trigger="pagination" data-target="#preorder-holding">
                        <li class="active"><a href="javascript:void(0)">1</a></li>
                      </ul>
                    </nav>
                  </div>

                  <div id="preorder-schedule" class="tab-pane middle">
                    <table class="table table-bordered" style="width: 100%;">
                      <thead>
                      <tr>
                        <td>照片</td>
                        <td>私房菜</td>
                        <td>单价</td>
                        <td>数量</td>
                        <td>实付款</td>
                        <td>状态</td>
                        <td>交易操作</td>
                      </tr>
                      </thead>
                      <%
                      var host = user.host;
                          host.host_orders.forEach(function(order){
                      if(order.type == "preorder" && order.status == "preparing"){
                      %>
                      <tbody class="item">
                      <tr class="active">
                        <td align="left" colspan="7">&nbsp&nbsp&nbsp&nbsp&nbsp<%= order.updatedAt%>&nbsp&nbsp&nbsp&nbsp&nbsp订单号:<%= order.id%>&nbsp&nbsp&nbsp&nbsp&nbsp厨师: <a href="/host/<%= host.id%>"><%= host.shopName%></a></td>
                      </tr>
                      <%
                        var list = Object.keys(order.orders);
                        var dishes = host.host_dishes;
                        var index = -1;
                          list.forEach(function(key){
                        var number = order.orders[key];
                          dishes.forEach(function(dish){
                      if(dish.id == key){
                        index++;
                      %>
                      <tr>
                        <td><img src="<%= dish.photos[0].v%>" style="width: 150px;"></td>
                        <td><%= dish.title%></td>
                        <td>$<%= dish.price.toFixed(2)%></td>
                        <td><%= number%></td>
                        <%if(index==0){%>
                        <td rowspan="<%= list.length%>" style="vertical-align: middle;">$<%= order.subtotal.toFixed(2)%><br>含送餐费<br>($<%= order.delivery_fee.toFixed(2)%>)</td>
                        <td rowspan="<%= list.length%>" style="vertical-align: middle;"><%= order.statusText()%></td>
                        <td rowspan="<%= list.length%>" style="vertical-align: middle;">
                          <a href="javascript:void(0)" data-action="cancel" data-order="<%= order.id%>">取消</a><br/>
                          <a data-target="#myModal" toggle="modal" href="javascript:void(0)" onclick="javascript:toggleModal(event)" data-href="/order/<%= order.id%>/adjust-form">调整</a><br/>
                          <a href="#">联系吃货</a>
                        </td>
                      </tr>
                      <%}%>
                      <%}})})%>
                      </tbody>
                      <%}})%>
                    </table>
                    <nav class="pull-right">
                      <ul class="pagination pagination-green pagination-sm" data-trigger="pagination" data-target="#preorder-schedule">
                        <li class="active"><a href="javascript:void(0)">1</a></li>
                      </ul>
                    </nav>
                  </div>

                  <div id="preorder-preparing" class="tab-pane middle">
                    <table class="table table-bordered">
                      <thead>
                      <tr>
                        <td>照片</td>
                        <td>私房菜</td>
                        <td>单价</td>
                        <td>数量</td>
                        <td>实付款</td>
                        <td>状态</td>
                        <td>交易操作</td>
                      </tr>
                      </thead>
                      <%
                      var host = user.host;
                          host.host_orders.forEach(function(order){
                      if(order.type == "preorder" && order.status == "preparing"){
                      %>
                      <tbody class="item">
                      <tr class="active">
                        <td align="left" colspan="7">&nbsp&nbsp&nbsp&nbsp&nbsp<%= order.updatedAt%>&nbsp&nbsp&nbsp&nbsp&nbsp订单号:<%= order.id%>&nbsp&nbsp&nbsp&nbsp&nbsp厨师: <a href="/host/<%= host.id%>"><%= host.shopName%></a></td>
                      </tr>
                      <%
                        var list = Object.keys(order.orders);
                        var dishes = host.host_dishes;
                        var index = -1;
                          list.forEach(function(key){
                        var number = order.orders[key];
                          dishes.forEach(function(dish){
                      if(dish.id == key){
                        index++;
                      %>
                      <tr>
                        <td><img src="<%= dish.photos[0].v%>" style="width: 150px;"></td>
                        <td><%= dish.title%></td>
                        <td>$<%= dish.price.toFixed(2)%></td>
                        <td><%= number%></td>
                        <%if(index==0){%>
                        <td rowspan="<%= list.length%>" style="vertical-align: middle;">$<%= order.subtotal.toFixed(2)%><br>含送餐费<br>($<%= order.delivery_fee.toFixed(2)%>)</td>
                        <td rowspan="<%= list.length%>" style="vertical-align: middle;"><%= order.statusText()%></td>
                        <td rowspan="<%= list.length%>" style="vertical-align: middle;">
                          <a href="javascript:void(0)" data-action="ready" data-order="<%= order.id%>">完成</a>
                          <a data-target="#myModal" toggle="modal" href="javascript:void(0)" onclick="javascript:toggleModal(event)" data-href="/order/<%= order.id%>/adjust-form">调整</a><br/>
                          <a href="#">联系吃货</a>
                        </td>
                      </tr>
                      <%}%>
                      <%}})})%>
                      </tbody>
                      <%}})%>
                    </table>
                    <nav class="pull-right">
                      <ul class="pagination pagination-green pagination-sm" data-trigger="pagination" data-target="#preorder-preparing">
                        <li class="active"><a href="javascript:void(0)">1</a></li>
                      </ul>
                    </nav>
                  </div>

                  <div id="preorder-prepared" class="tab-pane middle">
                    <table class="table table-bordered" style="width: 100%;">
                      <thead>
                      <tr>
                        <td>照片</td>
                        <td>私房菜</td>
                        <td>单价</td>
                        <td>数量</td>
                        <td>实付款</td>
                        <td>状态</td>
                        <td>交易操作</td>
                      </tr>
                      </thead>
                      <%
                      var host = user.host;
                          host.host_orders.forEach(function(order){
                      if(order.type == "preorder" && order.status == "ready"){
                      %>
                      <tbody class="item">
                      <tr class="active">
                        <td align="left" colspan="7">&nbsp&nbsp&nbsp&nbsp&nbsp<%= order.updatedAt%>&nbsp&nbsp&nbsp&nbsp&nbsp订单号:<%= order.id%>&nbsp&nbsp&nbsp&nbsp&nbsp厨师: <a href="/host/<%= host.id%>"><%= host.shopName%></a></td>
                      </tr>
                      <%
                        var list = Object.keys(order.orders);
                        var dishes = host.host_dishes;
                        var index = -1;
                          list.forEach(function(key){
                        var number = order.orders[key];
                          dishes.forEach(function(dish){
                      if(dish.id == key){
                        index++;
                      %>
                      <tr>
                        <td><img src="<%= dish.photos[0].v%>" style="width: 150px;"></td>
                        <td><%= dish.title%></td>
                        <td>$<%= dish.price.toFixed(2)%></td>
                        <td><%= number%></td>
                        <%if(index==0){%>
                        <td rowspan="<%= list.length%>" style="vertical-align: middle;">$<%= order.subtotal.toFixed(2)%><br>含送餐费<br>($<%= order.delivery_fee.toFixed(2)%>)</td>
                        <td rowspan="<%= list.length%>" style="vertical-align: middle;"><%= order.statusText()%></td>
                        <td rowspan="<%= list.length%>" style="vertical-align: middle;">
                          <a href="javascript:void(0)" data-action="receive" data-order="<%= order.id%>">确认取货</a><br/>
                          <a href="#">联系吃货</a>
                        </td>
                      </tr>
                      <%}%>
                      <%}})})%>
                      </tbody>
                      <%}})%>
                    </table>
                    <nav class="pull-right">
                      <ul class="pagination pagination-green pagination-sm" data-trigger="pagination" data-target="#preorder-prepared">
                        <li class="active"><a href="javascript:void(0)">1</a></li>
                      </ul>
                    </nav>
                  </div>

                  <div id="preorder-delivered" class="tab-pane middle">
                    <table class="table table-bordered" style="width: 100%;">
                      <thead>
                      <tr>
                        <td>照片</td>
                        <td>私房菜</td>
                        <td>单价</td>
                        <td>数量</td>
                        <td>实付款</td>
                        <td>状态</td>
                        <td>交易操作</td>
                      </tr>
                      </thead>
                      <%
                      var host = user.host;
                          host.host_orders.forEach(function(order){
                      if(order.type == "preorder" && order.status == "review"){
                      %>
                      <tbody class="item">
                      <tr class="active">
                        <td align="left" colspan="7">&nbsp&nbsp&nbsp&nbsp&nbsp<%= order.updatedAt%>&nbsp&nbsp&nbsp&nbsp&nbsp订单号:<%= order.id%>&nbsp&nbsp&nbsp&nbsp&nbsp厨师: <a href="/host/<%= host.id%>"><%= host.shopName%></a></td>
                      </tr>
                      <%
                        var list = Object.keys(order.orders);
                        var dishes = host.host_dishes;
                        var index = -1;
                          list.forEach(function(key){
                        var number = order.orders[key];
                          dishes.forEach(function(dish){
                      if(dish.id == key){
                        index++;
                      %>
                      <tr>
                        <td><img src="<%= dish.photos[0].v%>" style="width: 150px;"></td>
                        <td><%= dish.title%></td>
                        <td>$<%= dish.price.toFixed(2)%></td>
                        <td><%= number%></td>
                        <%if(index==0){%>
                        <td rowspan="<%= list.length%>" style="vertical-align: middle;">$<%= order.subtotal.toFixed(2)%><br>含送餐费<br>($<%= order.delivery_fee.toFixed(2)%>)</td>
                        <td rowspan="<%= list.length%>" style="vertical-align: middle;"><%= order.statusText()%></td>
                        <td rowspan="<%= list.length%>" style="vertical-align: middle;">
                        </td>
                      </tr>
                      <%}%>
                      <%}})})%>
                      </tbody>
                      <%}})%>
                    </table>
                    <nav class="pull-right">
                      <ul class="pagination pagination-green pagination-sm" data-trigger="pagination" data-target="#preorder-delivered">
                        <li class="active"><a href="javascript:void(0)">1</a></li>
                      </ul>
                    </nav>
                  </div>

                  <div id="preorder-reviewed" class="tab-pane middle">
                    <table class="table table-bordered" style="width: 100%;">
                      <thead>
                      <tr>
                        <td>照片</td>
                        <td>私房菜</td>
                        <td>单价</td>
                        <td>数量</td>
                        <td>实付款</td>
                        <td>状态</td>
                        <td>交易操作</td>
                      </tr>
                      </thead>
                      <%
                      var host = user.host;
                          host.host_orders.forEach(function(order){
                      if(order.type == "preorder" && order.status == "complete"){
                      %>
                      <tbody class="item">
                      <tr class="active">
                        <td align="left" colspan="7">&nbsp&nbsp&nbsp&nbsp&nbsp<%= order.updatedAt%>&nbsp&nbsp&nbsp&nbsp&nbsp订单号:<%= order.id%>&nbsp&nbsp&nbsp&nbsp&nbsp厨师: <a href="/host/<%= host.id%>"><%= host.shopName%></a></td>
                      </tr>
                      <%
                        var list = Object.keys(order.orders);
                        var dishes = host.host_dishes;
                        var index = -1;
                          list.forEach(function(key){
                        var number = order.orders[key];
                          dishes.forEach(function(dish){
                      if(dish.id == key){
                        index++;
                      %>
                      <tr>
                        <td><img src="<%= dish.photos[0].v%>" style="width: 150px;"></td>
                        <td><%= dish.title%></td>
                        <td>$<%= dish.price.toFixed(2)%></td>
                        <td><%= number%></td>
                        <%if(index==0){%>
                        <td rowspan="<%= list.length%>" style="vertical-align: middle;">$<%= order.subtotal.toFixed(2)%><br>含送餐费<br>($<%= order.delivery_fee.toFixed(2)%>)</td>
                        <td rowspan="<%= list.length%>" style="vertical-align: middle;"><%= order.statusText()%></td>
                        <td rowspan="<%= list.length%>" style="vertical-align: middle;">
                          <a href="/meal/<%= order.meal%>">查看评价</a>
                        </td>
                      </tr>
                      <%}%>
                      <%}})})%>
                      </tbody>
                      <%}})%>
                    </table>
                    <nav class="pull-right">
                      <ul class="pagination pagination-green pagination-sm" data-trigger="pagination" data-target="#preorder-reviewed">
                        <li class="active"><a href="javascript:void(0)">1</a></li>
                      </ul>
                    </nav>
                  </div>

                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="mymeal" style="width: 90%;" class="tab-pane middle">
          <div class="box box-shadow white">
            <div class="row">
              <div class="col-xs-12 vertical-align">
                <button class="btn btn-green btn-lg round middle" onclick="location.href='/host/me/createMeal'"><strong style="font-size: 16px;">添加一个Meal</strong></button>
                <i class="fa fa-question-circle fa-2x text-lightgrey cursor-pointer"></i>
              </div>
            </div>
            <ul class="nav nav-tabs" style="margin-top: 20px;margin-bottom: 10px;">
              <li class="active"><a data-toggle="tab" href="#allmeals" class="btn-lg text-dark"><strong>所有菜单</strong></a></li>
              <li><a data-toggle="tab" href="#livemeals" class="btn-lg text-dark"><strong>已发布菜单</strong></a></li>
              <li><a data-toggle="tab" href="#ongoingmeals" class="btn-lg text-dark"><strong>待审核菜单</strong></a></li>
              <li><a data-toggle="tab" href="#offmeals" class="btn-lg text-dark"><strong>未发布菜单</strong></a></li>
            </ul>
            <div class="tab-content" style="padding-top: 20px;padding-bottom: 60px;">
              <div id="allmeals" style="width: 90%;" class="tab-pane middle active">
                <table id="allmeals-content" class="table table-bordered" style="width: 100%;">
                  <thead>
                  <tr>
                    <td>照片/名称</td>
                    <td>分数</td>
                    <td>已售 <i class="fa fa-question-circle"></i></td>
                    <td>状态 <i class="fa fa-question-circle"></i></td>
                    <td>操作 <i class="fa fa-question-circle"></i></td>
                    <td>发布/下架 <i class="fa fa-question-circle"></i></td>
                  </tr>
                  </thead>
                  <%
                  var meals = user.host.meals;
                  if(meals && meals.length > 0){
                  for(var j=0; j < meals.length; j++){
                    var meal = meals[j];
                  %>
                  <tbody class="item">
                    <tr class="success">
                      <% if(meal.type=="order"){%>
                      <td align="left" colspan="6">最后发布时间 ：<%= meal.updatedAt%> &nbsp&nbsp&nbsp&nbsp&nbsp方式:即点&nbsp&nbsp&nbsp&nbsp&nbsp供应时间: <span data-toggle="time-span" data-format="hourly" data-from="<%= meal.provideFromTime%>" data-to="<%= meal.provideTillTime%>"></span></td>
                      <%}else{%>
                      <td align="left" colspan="6">最后发布时间 ：<%= meal.updatedAt%> &nbsp&nbsp&nbsp&nbsp&nbsp方式:预定&nbsp&nbsp&nbsp&nbsp&nbsp预定时间: <span data-toggle="time-span" data-format="hourly" data-from="<%= meal.provideFromTime%>" data-to="<%= meal.provideTillTime%>"></span>&nbsp&nbsp&nbsp&nbsp&nbsp取货时间:&nbsp <span data-toggle="time-span" data-format="day" data-date="<%= meal.pickups[0].pickupFromTime%>"></span></td>
                      <%}%>
                    </tr>
                    <tr>
                      <td><img src="<%= meal.coverString || '/images/food_default.png'%>" style="width: 200px;"><br><%= meal.title%></td>
                      <td style="vertical-align: middle;">
                        <div data-toggle="tooltip" data-placement="bottom" title="<%= meal.score.toFixed(1)%>">
                          <div class="rating" data-toggle="star-set" data-rate="<%= meal.score%>">
                            <i class="fa fa-star"></i>
                            <i class="fa fa-star"></i>
                            <i class="fa fa-star"></i>
                            <i class="fa fa-star"></i>
                            <i class="fa fa-star"></i>
                          </div>
                        </div>
                      </td>
                      <td style="vertical-align: middle;"><%= meal.numberOfReviews%></td>
                      <td style="vertical-align: middle;">
                        <%
                        switch(meal.status){
                        case "on":%>
                        <label class="text-green">在线</label>
                        <%  break;
                        case "off":%>
                        <label class="text-grey">离线</label>
                        <%   break;
                        case "ongoing":%>
                        审核中
                        <%   break;
                        case "fail":%>
                        <label class="text-red">审核失败</label>
                        <%   break;} %>
                      </td>
                      <td style="vertical-align: middle;">
                        <!--<a class="text-grey" href="/meal/<%= meal.id%>?edit=true">更新</a><br>-->
                        <a class="text-grey" href="/meal/<%= meal.id%>?edit=true">编辑</a><br>
                        <a class="text-grey" href="javascript:void(0)" data-toggle="alert-button" data-title="确认删除?" data-content="" data-actionFn="javascript:deleteMeal" data-argument="<%= meal.id%>">删除</a><br/>
                      <td style="vertical-align: middle;">
                        <% if(meal.status == "on"){%>
                        <a class="text-red" href="/meal/<%= meal.id%>/off">下架</a>
                        <%}else if(meal.status =="off"){%>
                        <a href="/meal/<%= meal.id%>/on">上线</a>
                        <%}%>
                      </td>
                    </tr>
                  </tbody>
                  <%}}%>
                </table>
                <nav class="pull-right">
                  <ul class="pagination pagination-green pagination-sm" data-trigger="pagination" data-target="#allmeals-content">
                    <li class="active"><a href="javascript:void(0)">1</a></li>
                  </ul>
                </nav>
              </div>
              <div id="livemeals" style="width: 90%;" class="tab-pane middle">
                <table id="livemeals-content" class="table table-bordered" style="width: 100%;">
                  <thead>
                  <tr>
                    <td>照片/名称</td>
                    <td>分数</td>
                    <td>已售 <i class="fa fa-question-circle"></i></td>
                    <td>状态 <i class="fa fa-question-circle"></i></td>
                    <td>操作 <i class="fa fa-question-circle"></i></td>
                    <td>发布/下架 <i class="fa fa-question-circle"></i></td>
                  </tr>
                  </thead>
                  <%
                  var meals = user.host.meals;
                  if(meals && meals.length > 0){
                  for(var k=0; k < meals.length; k++){
                    var meal = meals[k];
                    if(meal.status == "on"){
                  %>
                  <tbody class="item">
                  <tr class="success">
                    <% if(meal.type=="order"){%>
                    <td align="left" colspan="6">最后发布时间 ：<%= meal.updatedAt%> &nbsp&nbsp&nbsp&nbsp&nbsp方式:即点&nbsp&nbsp&nbsp&nbsp&nbsp供应时间: <span data-toggle="time-span" data-format="hourly" data-from="<%= meal.provideFromTime%>" data-to="<%= meal.provideTillTime%>"></span></td>
                    <%}else{%>
                    <td align="left" colspan="6">最后发布时间 ：<%= meal.updatedAt%> &nbsp&nbsp&nbsp&nbsp&nbsp方式:预定&nbsp&nbsp&nbsp&nbsp&nbsp预定时间: <span data-toggle="time-span" data-format="hourly" data-from="<%= meal.provideFromTime%>" data-to="<%= meal.provideTillTime%>"></span>&nbsp&nbsp&nbsp&nbsp&nbsp取货时间:&nbsp <span data-toggle="time-span" data-format="day" data-date="<%= meal.pickups[0].pickupFromTime%>"></span></td>
                    <%}%>
                  </tr>
                  <tr>
                    <td><img src="<%= meal.coverString || '/images/food_default.png'%>" style="width: 200px;"><br><%= meal.title%></td>
                    <td style="vertical-align: middle;">
                      <div data-toggle="tooltip" data-placement="bottom" title="<%= meal.score.toFixed(1)%>">
                        <div class="rating" data-toggle="star-set" data-rate="<%= meal.score%>">
                        <i class="fa fa-star"></i>
                        <i class="fa fa-star"></i>
                        <i class="fa fa-star"></i>
                        <i class="fa fa-star"></i>
                        <i class="fa fa-star"></i>
                      </div>
                    </td>
                    <td style="vertical-align: middle;"><%= meal.numberOfReviews%></td>
                    <td style="vertical-align: middle;">
                      <%
                      switch(meal.status){
                      case "on":%>
                      <label class="text-green">在线</label>
                      <%  break;
                      case "off":%>
                      <label class="text-grey">离线</label>
                      <%   break;
                      case "ongoing":%>
                      审核中
                      <%   break;
                      case "fail":%>
                      <label class="text-red">审核失败</label>
                      <%   break;} %>
                    </td>
                    <td style="vertical-align: middle;">
                      <!--<a class="text-grey" href="/meal/<%= meal.id%>?edit=true">更新</a><br>-->
                      <a class="text-grey" href="/meal/<%= meal.id%>?edit=true">编辑</a><br>
                      <a class="text-grey" href="javascript:void(0)" data-toggle="alert-button" data-title="确认删除?" data-content="" data-actionFn="javascript:deleteMeal" data-argument="<%= meal.id%>">删除</a><br/>
                    <td style="vertical-align: middle;"><a class="text-red" href="/meal/<%= meal.id%>/off">下架</a></td>
                  </tr>
                  </tbody>
                  <%}}}%>
                </table>
                <nav class="pull-right">
                  <ul class="pagination pagination-green pagination-sm" data-trigger="pagination" data-target="#livemeals-content">
                    <li class="active"><a href="javascript:void(0)">1</a></li>
                  </ul>
                </nav>
              </div>

              <div id="ongoingmeals" style="width: 90%;" class="tab-pane middle">
                <table id="ongoingmeals-content" class="table table-bordered" style="width: 100%;">
                  <thead>
                  <tr>
                    <td>照片/名称</td>
                    <td>分数</td>
                    <td>已售 <i class="fa fa-question-circle"></i></td>
                    <td>状态 <i class="fa fa-question-circle"></i></td>
                    <td>操作 <i class="fa fa-question-circle"></i></td>
                    <td>发布/下架 <i class="fa fa-question-circle"></i></td>
                  </tr>
                  </thead>

                  <%
                  var meals = user.host.meals;
                  if(meals && meals.length > 0){
                  for(var k=0; k < meals.length; k++){
                    var meal = meals[k];
                  if(meal.status == "ongoing"){
                  %>
                  <tbody class="item">
                  <tr class="success">
                    <% if(meal.type=="order"){%>
                    <td align="left" colspan="6">最后发布时间 ：<%= meal.updatedAt%> &nbsp&nbsp&nbsp&nbsp&nbsp方式:即点&nbsp&nbsp&nbsp&nbsp&nbsp供应时间: <span data-toggle="time-span" data-format="hourly" data-from="<%= meal.provideFromTime%>" data-to="<%= meal.provideTillTime%>"></span></td>
                    <%}else{%>
                    <td align="left" colspan="6">最后发布时间 ：<%= meal.updatedAt%> &nbsp&nbsp&nbsp&nbsp&nbsp方式:预定&nbsp&nbsp&nbsp&nbsp&nbsp预定时间: <span data-toggle="time-span" data-format="hourly" data-from="<%= meal.provideFromTime%>" data-to="<%= meal.provideTillTime%>"></span>&nbsp&nbsp&nbsp&nbsp&nbsp取货时间:&nbsp <span data-toggle="time-span" data-format="day" data-date="<%= meal.pickups[0].pickupFromTime%>"></span></td>
                    <%}%>
                  </tr>
                  <tr>
                    <td><img src="<%= meal.coverString || '/images/food_default.png'%>" style="width: 200px;"><br><%= meal.title%></td>
                    <td style="vertical-align: middle;">
                      <div data-toggle="tooltip" data-placement="bottom" title="<%= meal.score.toFixed(1)%>">
                        <div class="rating" data-toggle="star-set" data-rate="<%= meal.score%>">
                        <i class="fa fa-star"></i>
                        <i class="fa fa-star"></i>
                        <i class="fa fa-star"></i>
                        <i class="fa fa-star"></i>
                        <i class="fa fa-star"></i>
                      </div>
                    </td>
                    <td style="vertical-align: middle;"><%= meal.numberOfReviews%></td>
                    <td style="vertical-align: middle;">
                      <%
                      switch(meal.status){
                      case "on":%>
                      <label class="text-green">在线</label>
                      <%  break;
                      case "off":%>
                      <label class="text-grey">离线</label>
                      <%   break;
                      case "ongoing":%>
                      审核中
                      <%   break;
                      case "fail":%>
                      <label class="text-red">审核失败</label>
                      <%   break;} %>
                    </td>
                    <td style="vertical-align: middle;">
                      <!--<a class="text-grey" href="/meal/<%= meal.id%>?edit=true">更新</a><br>-->
                      <a class="text-grey" href="/meal/<%= meal.id%>?edit=true">编辑</a><br>
                      <a class="text-grey" href="javascript:void(0)" data-toggle="alert-button" data-title="确认删除?" data-content="" data-actionFn="javascript:deleteMeal" data-argument="<%= meal.id%>">删除</a><br/>
                  </tr>
                  </tbody>
                  <%}}}%>
                </table>
                <nav class="pull-right">
                  <ul class="pagination pagination-green pagination-sm" data-trigger="pagination" data-target="#ongoingmeals-content">
                    <li class="active"><a href="javascript:void(0)">1</a></li>
                  </ul>
                </nav>
              </div>

              <div id="offmeals" style="width: 90%;" class="tab-pane middle">
                <table id="offmeals-content" class="table table-bordered" style="width: 100%;">
                  <thead>
                  <tr>
                    <td>照片/名称</td>
                    <td>分数</td>
                    <td>已售 <i class="fa fa-question-circle"></i></td>
                    <td>状态 <i class="fa fa-question-circle"></i></td>
                    <td>操作 <i class="fa fa-question-circle"></i></td>
                    <td>发布/下架 <i class="fa fa-question-circle"></i></td>
                  </tr>
                  </thead>

                  <%
                  var meals = user.host.meals;
                  if(meals && meals.length > 0){
                  for(var k=0; k < meals.length; k++){
                    var meal = meals[k];
                  if(meal.status == "off"){
                  %>
                  <tbody class="item">
                  <tr class="success">
                    <% if(meal.type=="order"){%>
                    <td align="left" colspan="6">最后发布时间 ：<%= meal.updatedAt%> &nbsp&nbsp&nbsp&nbsp&nbsp方式:即点&nbsp&nbsp&nbsp&nbsp&nbsp供应时间: <span data-toggle="time-span" data-format="hourly" data-from="<%= meal.provideFromTime%>" data-to="<%= meal.provideTillTime%>"></span></td>
                    <%}else{%>
                    <td align="left" colspan="6">最后发布时间 ：<%= meal.updatedAt%> &nbsp&nbsp&nbsp&nbsp&nbsp方式:预定&nbsp&nbsp&nbsp&nbsp&nbsp预定时间: <span data-toggle="time-span" data-format="hourly" data-from="<%= meal.provideFromTime%>" data-to="<%= meal.provideTillTime%>"></span>&nbsp&nbsp&nbsp&nbsp&nbsp取货时间:&nbsp <span data-toggle="time-span" data-format="day" data-date="<%= meal.pickups[0].pickupFromTime%>"></span></td>
                    <%}%>
                  </tr>
                  <tr>
                    <td><img src="<%= meal.coverString || '/images/food_default.png'%>" style="width: 200px;"><br><%= meal.title%></td>
                    <td style="vertical-align: middle;">
                      <div data-toggle="tooltip" data-placement="bottom" title="<%= meal.score.toFixed(1)%>">
                        <div class="rating" data-toggle="star-set" data-rate="<%= meal.score%>">
                        <i class="fa fa-star"></i>
                        <i class="fa fa-star"></i>
                        <i class="fa fa-star"></i>
                        <i class="fa fa-star"></i>
                        <i class="fa fa-star"></i>
                      </div>
                    </td>
                    <td style="vertical-align: middle;"><%= meal.numberOfReviews%></td>
                    <td style="vertical-align: middle;">
                      <%
                      switch(meal.status){
                      case "on":%>
                      <label class="text-green">在线</label>
                      <%  break;
                      case "off":%>
                      <label class="text-grey">离线</label>
                      <%   break;
                      case "ongoing":%>
                      审核中
                      <%   break;
                      case "fail":%>
                      <label class="text-red">审核失败</label>
                      <%   break;} %>
                    </td>
                    <td style="vertical-align: middle;">
                      <!--<a class="text-grey" href="/meal/<%= meal.id%>?edit=true">更新</a><br>-->
                      <a class="text-grey" href="/meal/<%= meal.id%>?edit=true">编辑</a><br>
                      <a class="text-grey" href="javascript:void(0)" data-toggle="alert-button" data-title="确认删除?" data-content="" data-actionFn="javascript:deleteMeal" data-argument="<%= meal.id%>">删除</a></td>
                    <td style="vertical-align: middle;"><a class="text-grey" href="/meal/<%= meal.id%>/on">上架</a></td>
                  </tr>
                  </tbody>
                  <%}}}%>
                </table>
                <nav class="pull-right">
                  <ul class="pagination pagination-green pagination-sm" data-trigger="pagination" data-target="#offmeals-content">
                    <li class="active"><a href="javascript:void(0)">1</a></li>
                  </ul>
                </nav>
              </div>
            </div>

          </div>
        </div>

        <div id="mydish" style="width: 90%;" class="tab-pane middle">
          <div class="row">
            <div class="col-md-8" style="margin-bottom: 20px;">
              <div class="box box-shadow white">
                <div class="col-xs-12">
                  <div class="middle vertical-align">
                    <button class="btn btn-green btn-lg round middle" onclick="location.href='/host/me/createDish'"><strong style="font-size: 16px;">添加一款新菜</strong></button>
                    <i class="fa fa-question-circle fa-2x text-lightgrey cursor-pointer"></i>
                  </div>
                </div>
                <div class="col-xs-12" style="margin-top: 20px;">
                  <table id="dish-content" class="table" style="width: 100%;">
                    <thead>
                    <tr>
                      <td>照片/名称</td>
                      <td>状态</td>
                      <td>评价</td>
                      <td>单价</td>
                      <td>已售 <i class="fa fa-question-circle text-lightgrey"></i></td>
                      <td>操作 <i class="fa fa-question-circle text-lightgrey"></i></td>
                    </tr>
                    </thead>
                    <%
                    var dishes = user.host.dishes;
                    if(dishes && dishes.length > 0) {
                      for(var i=0; i < dishes.length; i++){
                        var dish = dishes[i];
                    %>
                    <tbody class="item">
                    <tr class="active" data-id="<%= dish.id%>">
                      <td><%= dish.title%></td>
                      <td colspan="5">创建于 <%= dish.createdAt%></td>
                    </tr>
                    <tr>
                      <td><img style="width: 150px;max-height: 150px;" src="<%= dish.photos[0].v%>"></td>
                      <td style="vertical-align: middle;"><%= dish.isVerified? "通过":"审核中"%></td>
                      <td style="vertical-align: middle;"><i class="fa fa-star-o"></i> <%= dish.score.toFixed(1) %></td>
                      <td style="vertical-align: middle;">$<%= dish.price.toFixed(2)%></td>
                      <td style="vertical-align: middle;"><%= dish.numberOfReviews%></td>
                      <td style="vertical-align: middle;">
                        <!--<a href="#">加数量</a><br/>-->
                        <a href="/dish/<%= dish.id%>?edit=true">修改</a><br/>
                        <a href="javascript:void(0)" data-toggle="alert-button" data-title="确认删除?" data-content="" data-actionFn="javascript:deleteDish" data-argument="<%= dish.id%>">删除</a><br/>
                      </td>
                    </tr>
                    </tbody>
                    <%}}%>

                  </table>
                  <nav class="pull-right">
                    <ul class="pagination pagination-green pagination-sm" data-trigger="pagination" data-target="#dish-content">
                      <li class="active"><a href="javascript:void(0)">1</a></li>
                    </ul>
                  </nav>
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="box box-shadow white">
                <div class="col-xs-12" style="margin-bottom: 15px;">
                  <img class="cursor-pointer round_thumb size-large" src="<% if(user.picture){%><%= user.picture%><%}else{%>/images/profile_man.png<%}%>" onclick="location.href='/user/me#info'">
                </div>
                <h4>
                  <%= user.firstname %>&nbsp;<%=user.lastname%> <i class="fa fa-edit text-lightgrey cursor-pointer" onclick="location.href='/user/me#myinfo'"></i>
                </h4>
                <h5>
                  电话: +<%= user.phone%> <i class="fa fa-edit text-lightgrey cursor-pointer" onclick="location.href='/user/me#myinfo'"></i>
                </h5>
                <h5>
                  <%= user.desc %> <i class="fa fa-edit text-lightgrey cursor-pointer" onclick="location.href='/user/me#myinfo'"></i>
                </h5>
                <h5>
                  <p class="text-lightgrey">邮箱: <%= user.auth.email%></p>
                </h5>
              </div>
            </div>
          </div>
        </div>

        <div id="myinfo" style="width: 90%;" class="tab-pane middle">
          <div class="box box-shadow white">
            <form class="form-horizontal text-left" data-id="<%= user.host.id%>" data-err-container="#formAlert">

              <div class="license">
                <label>1. 私房厨师执照 </strong><i class="fa fa-question-circle text-lightgrey cursor-pointer"></i></label>
                <div class="text-left row license">
                  <div class="col-xs-5">
                    <div class="fileinput <%= user.host.license? 'fileinput-exists' : 'fileinput-new'%>" data-provides="fileinput">
                      <div class="fileinput-new thumbnail text-center">
                        <img class="cursor-pointer" src="/images/upload_default.png" onclick="$('#licenseUpload').trigger('click')">
                      </div>
                      <div class="fileinput-preview fileinput-exists thumbnail" style="max-height: 260px;" data-src="<%= user.host.license%>">
                        <img class="cursor-pointer" src="<%= user.host.license ? user.host.license : '/images/upload_default.png'%>" style="max-height: 250px;" onclick="$('#licenseUpload').trigger('click')">
                      </div>
                      <div>
                        <span class="btn btn-default btn-file"><span class="fileinput-new">Select image</span><span class="fileinput-exists">Change</span><input id="licenseUpload" type="file" onchange="uploadLicense(event)" data-error-container=".license"></span>
                          <!--<a href='javascript:void(0)' class="btn btn-default fileinput-exists dimiss" data-dismiss="fileinput">Remove</a>-->
                        <script>
                          $(".fileinput").on("clear.bs.fileinput",function(){
                            $("input[type='file']").data("isDelete",true);
                          });
                        </script>
                      </div>
                      <!--<button class="btn btn-green round" type="text" style="width:100px;" onclick="uploadLicense(event)" data-error-container=".license">上传执照</button>-->
                    </div>
                  </div>
                  <div class="col-xs-12">
                    <div class="alert alert-danger" data-toggle="alert"></div>
                  </div>
                </div>
              </div>

              <h1></h1>
              <label>2. 厨房地址 </strong><i class="fa fa-question-circle text-lightgrey cursor-pointer"></i></label>
              <h5 class="text-left">你当前的厨房地址为：</h5>
              <div id="hostAddressView" class="text-left box-grid">
                <div class="address_block" data-host="true" data-id="<%= user.host.id%>" data-street="<%= user.host.street || ""%>" data-city="<%= user.host.city || ""%>" data-zip="<%= user.host.zip || ""%>" data-phone="<%=user.phone || ""%>">
                  <label class="text-green">［厨房］</label>
                  <label><%= user.host.full_address || "请输入地址" %><br/> <%= user.phone %></label>
                  <a class="text-green cursor-pointer edit" toggle="modal" data-target="#myModal" data-href="/templates/user/address.html">修改</a>
                </div>
              </div>

              <h1></h1>

              <label>3. 私厨故事 <i class="fa fa-question-circle text-lightgrey cursor-pointer"></i></label>
              <div class="row story">
                <div class="col-sm-5">
                  <label>(1) 厨房标题 <i class="fa fa-question-circle text-lightgrey cursor-pointer"></i></label>
                  <input class="form-control" data-error="厨房标题最长七个字" name="story-title" maxlength="7" type="text" class="form-control" placeholder="<% if(typeof user.host.shopName == 'undefined'){%>标题最多七个字<%}else{%><%= user.host.shopName %><%}%>" value="<% if(typeof user.host.shopName == 'undefined'){%><%}else{%><%= user.host.shopName %><%}%>">
                  <div class="help-block with-errors"></div>
                  <label>(2) 厨师照片 </strong><i class="fa fa-question-circle text-lightgrey cursor-pointer"></i></label>

                  <div class="fileinput <%= user.host.picture ? 'fileinput-exists' : 'fileinput-new'%>" data-provides="fileinput" style="width: 100%;">
                    <div class="fileinput-new thumbnail">
                      <img class="cursor-pointer" src="/images/upload_default.png" onclick="$('storyUpload').trigger('click')">
                    </div>
                    <div class="fileinput-preview fileinput-exists thumbnail" style="max-height: 275px;" data-src="<%= user.host.picture%>">
                      <img class="cursor-pointer" src="<%= user.host.picture ? user.host.picture : '/images/upload_default.png'%>" style="max-height: 265px;" onclick="$('#storyUpload').trigger('click')">
                    </div>
                    <div>
                    <span class="btn btn-default btn-file"><span class="fileinput-new">Select image</span><span class="fileinput-exists">Change</span>
                      <input name='story-pic' id="storyUpload" type="file" onchange="uploadHostPhoto(event)" data-error-container=".story">
                    </span>
                      <!--<a href='javascript:void(0)' class="btn btn-default fileinput-exists dimiss" data-dismiss="fileinput">Remove</a>-->
                      <script>
                        $(".fileinput").on("clear.bs.fileinput",function(){
                          $("input[type='file']").data("isDelete",true);
                        });
                      </script>
                    </div>
                    <!--<button class="btn btn-green round" type="text" style="width:100px;" onclick="uploadHostPhoto(event)" data-error-container=".story">上传照片</button>-->
                  </div>
                  <div class="alert alert-danger" data-toggle="alert"></div>
                </div>

                <div class="col-sm-7">
                  <label>(3) 故事文本 <i class="fa fa-question-circle text-lightgrey cursor-pointer"></i></label>
                  <textarea class="form-control" data-error="故事最长300字" maxlength="300" name="story-intro" style="width: 100%;height: 360px;"><%if(typeof user.host.intro != 'undefined'){%><%= user.host.intro %><%}%></textarea>
                  <div class="help-block with-errors"></div>
                </div>
              </div>

              <label>4. 选择三款拿手小菜 <i class="fa fa-question-circle text-lightgrey cursor-pointer"></i></label>
              <div class="row dishes">
                <div class="col-xs-4">
                  <div class="dropdown" style="margin-bottom: 10px;">
                    <a class="btn btn-default btn-outline dropdown-toggle text-dark" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" data-value="<%var features = user.host.feature_dishes;if( typeof features != 'undefined' && features[0].dish1.id != ""){ %><%= features[0].dish1.id %><%}else{%>0<%} %>">
                      <div style="width: 100px;display: inline-block;">
                        <%
                        var features = user.host.feature_dishes;
                        if( typeof features != 'undefined' && features[0].dish1.id != "0"){
                        %>
                        <%= features[0].dish1.title %>
                        <%}else{%>
                        第一款
                        <%} %>
                      </div>
                      <span class="caret"></span>
                    </a>
                    <ul class="dropdown-menu signatureDish" aria-labelledby="dropdownMenu1">
                      <%
                        var dishes = user.host.dishes;
                        var count = dishes.length;
                        for(var i=0; i < count; i++){
                          var dish = dishes[i];
                      %>
                      <li><a href="javascript:void(0)" data-value="<%= dish.id%>"><%=dish.title%></a></li>
                      <%}%>
                    </ul>
                  </div>
                </div>
                <div class="col-xs-4">
                  <div class="dropdown" style="margin-bottom: 10px;">
                    <a class="btn btn-default btn-outline dropdown-toggle text-dark" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" data-value="<%var features = user.host.feature_dishes;if( typeof features != 'undefined' && features[1].dish2.id != ""){ %><%= features[1].dish2.id %><%}else{%>0<%}%>">
                      <div style="width: 100px;display: inline-block;">
                        <%
                        var features = user.host.feature_dishes;
                        if( typeof features != 'undefined' && features[1].dish2.id != "0"){
                        %>
                        <%= features[1].dish2.title %>
                        <%}else{%>
                        第二款
                        <%} %>
                      </div>
                      <span class="caret"></span>
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                      <%
                      var dishes = user.host.dishes;
                      var count = dishes.length;
                      for(var i=0; i < count; i++){
                        var dish = dishes[i];
                      %>
                      <li><a href="javascript:void(0)" data-value="<%= dish.id%>"><%=dish.title%></a></li>
                      <%}%>
                    </ul>
                  </div>
                </div>
                <div class="col-xs-4">
                  <div class="dropdown">
                    <a class="btn btn-default btn-outline dropdown-toggle text-dark" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" data-value="<%var features = user.host.feature_dishes;if( typeof features != 'undefined' && features[2].dish3.id != ""){ %><%= features[2].dish3.id %><%}else{%>0<%} %>">
                    <div style="width: 100px;display: inline-block;">
                      <%
                        var features = user.host.feature_dishes;
                        if( typeof features != 'undefined' && features[2].dish3.id != "0"){
                      %>
                      <%= features[2].dish3.title %>
                      <%}else{%>
                      第三款
                      <%} %>
                    </div>
                      <span class="caret"></span>
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                      <%
                      var dishes = user.host.dishes;
                      var count = dishes.length;
                      for(var i=0; i < count; i++){
                        var dish = dishes[i];
                      %>
                      <li><a href="javascript:void(0)" data-value="<%= dish.id%>"><%=dish.title%></a></li>
                      <%}%>
                    </ul>
                  </div>
                </div>
              </div>

              <div class="row">
                <div id="formAlert" class="alert alert-danger" data-toggle="alert"></div>
              </div>

              <div class="row text-center" style="margin-top: 20px;">
                <button type="button" class="btn btn-green round" style="width: 150px;margin-right: 10px;">预览</button>
                <button type="submit" class="btn btn-green round" style="width: 150px;margin-right: 10px;">保存</button>
                <!--<button type="button" name="cancel" class="btn btn-disable round text-grey" style="width: 150px;margin-right: 10px;">取消</button>-->
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  $("#myinfo form").validator({});
  var hostProfileView = new HostProfileView( { el : $("#myinfo"), model : new Host()})
  new AddressView({ el : $("#hostAddressView"), model : new Host()})
  var orderView = new OrderView({ el : $("#myorder"), model : new Order()})
</script>
